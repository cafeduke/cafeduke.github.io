<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta data -->
    <meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, shrink-to-fit=no, width=device-width">
<meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Window title -->
    <title>Gradient momentum with Adam optimization</title>

    <!-- CSS -->
    <!-- Material fonts from 'https://fonts.google.com' -->
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Vollkorn:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"> 

<!-- Material Icon -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Font Awesome Icon -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

<!-- Add Material CSS. Replace Bootstrap CSS -->
<link href="/assets/daemonite-material/css/material.min.css" rel="stylesheet">

<!-- Material Color Palette - CSS Classes -->
<link href="/assets/material-design-color-palette/css/material-design-color-palette.css" rel="stylesheet">

<!-- CafeDuke CSS - Project specific Classes  -->
<link href="/assets/css/main.css" rel="stylesheet" type="text/css">

<!-- CafeDuke Syntax CSS - Code syntax highlight -->
<link href="/assets/css/duke-dark.css" rel="stylesheet" type="text/css">


<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

    <!-- Navigation bar -->
    <nav class="navbar navbar-expand-lg navbar-dark mdc-bg-purple-900">
    
    

    <!-- Collapse Icon -->
    <a id="sidebar-toggle" class="navbar-brand text-white" href="">
        <i class="material-icons md-24">menu</i>
    </a>

    <!-- NavBar Heading -->
    <a class="navbar-brand text-white" href="/">Cafe Duke Notes</a>

    <!-- Collapse button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">

        <!-- Links -->
        <ul class="navbar-nav mr-auto">


        </ul>
        <!-- Links -->

        <!-- Search form
        <form class="form-inline">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
        </form>
         -->

    </div>
    <!-- Collapsible content -->

</nav>


    <!-- Row: Content -->
    <div class="container-fluid m-0 p-0 h-100">

        <div class="row h-100 no-gutters">

            <!-- Column: Sidebar -->
            <div id="sidebar">

    <ul class="nav flex-column">

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/">
                <i class="fas fa-home fa-lg"></i>
                <span class="nav-link-text">Home</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/java">
                <i class="fab fa-java fa-2x"></i>
                <span class="nav-link-text">Java</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/git">
                <i class="fab fa-git fa-lg"></i>
                <span class="nav-link-text">Git</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/cloud">
                <i class="material-icons md-24">cloud</i>
                <span class="nav-link-text">Cloud</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" data-toggle="collapse" data-target="#child-dl" href="#">
                <i class="fas fa-cogs fa-lg"></i>
                <span class="nav-link-text">Deep Learning</span>
            </a>
            <div id="child-dl" class="collapse">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning">
                            <span class="nav-link-text">Core</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/strategy">
                            <span class="nav-link-text">Strategy</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/cnn">
                            <span class="nav-link-text">CNN</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/rnn">
                            <span class="nav-link-text">RNN</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/django">
                <i class="fa fa-lg">dj</i>
                <span class="nav-link-text">Django</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/spring">
                <i class="fas fa-leaf fa-lg"></i>
                <span class="nav-link-text">Spring</span>
            </a>
        </li>

    </ul>
</div>


            <!-- Column: Content Wrapper -->
            <div class="col">
                <div id="content" class="w-100">
<div id="post-wrap" class="row d-flex justify-content-center">

    <div class="card col-md-10 col-xs-12 mt-5">

        <div class="card-header">
            <h1 class="post-title">Gradient momentum with Adam optimization</h1>
            <h6 class="card-subtitle post-meta"> 
                Thursday, 23 November 2017
                
            </h6>            
        </div>

        <hr class="post-ruler">

        <div class="card-body">
            <nav>
  <h4>Table of Contents</h4>
<ol id="markdown-toc">
  <li>
<a href="#introduction" id="markdown-toc-introduction">Introduction</a>    <ol>
      <li><a href="#why-learning-rate-cannot-be-increased-in-gradient-descent" id="markdown-toc-why-learning-rate-cannot-be-increased-in-gradient-descent">Why learning rate cannot be increased in gradient descent?</a></li>
      <li><a href="#why-do-we-have-oscillations-with-increased-alpha" id="markdown-toc-why-do-we-have-oscillations-with-increased-alpha">Why do we have oscillations with increased alpha?</a></li>
    </ol>
  </li>
  <li><a href="#momentum" id="markdown-toc-momentum">Momentum</a></li>
  <li>
<a href="#momentum-with-rmsprop" id="markdown-toc-momentum-with-rmsprop">Momentum with RMSprop</a>    <ol>
      <li><a href="#algorithm" id="markdown-toc-algorithm">Algorithm</a></li>
      <li><a href="#working" id="markdown-toc-working">Working</a></li>
    </ol>
  </li>
  <li>
<a href="#momentum-with-adam" id="markdown-toc-momentum-with-adam">Momentum with Adam</a>    <ol>
      <li><a href="#algorithm-1" id="markdown-toc-algorithm-1">Algorithm</a></li>
    </ol>
  </li>
  <li><a href="#bias-correction" id="markdown-toc-bias-correction">Bias Correction</a></li>
</ol>

</nav>

<h1 id="introduction">Introduction</h1>

<p>Gradient descent with momentum works faster than the regular gradient descent. The idea is to calculate the exponentially weighted average (running average) of the derivatives (from back propagation) and use these to update the weights.</p>

<h2 id="why-learning-rate-cannot-be-increased-in-gradient-descent">Why learning rate cannot be increased in gradient descent?</h2>

<p>The learning rate controls the momentum with which we are approaching the optima. However increasing the learning rate may cause the descent to oscillate more rather than move towards the optima.</p>

<p>Think of gradient descent to be a ball moving towards the center of a bowl.</p>

<ul>
  <li>Weights are altered by ($$\alpha * dW$$). This makes the ball to move to a new position in the next descent.</li>
  <li>If the new position of the ball is more towards the side of the bowl and less towards the center, it results in oscillation.</li>
</ul>

<p>Essentially, most momentum added by $$\alpha$$ goes sidewards and less downwards which is not useful.</p>

<h2 id="why-do-we-have-oscillations-with-increased-alpha">Why do we have oscillations with increased alpha?</h2>

<p><img src="/assets/images/Oscillation.jpg" alt="Oscillation"></p>

<p>In the diagram above, W1 and W2 are two weights based on which the cost contour graph is drawn.</p>

<ul>
  <li>Initially, lets say the weights are at point A.</li>
  <li>To reach the optimal point in green, less distance has to covered vertically and more distance has to be covered horizontally. That is, W2 should reduce by small factor while W1 should increase by a large factor.</li>
  <li>Consider W1
    <ul>
      <li>Lets keep W2 constant resulting in the sliceW1.</li>
      <li>The curve that we have due to sliceW1 (front view) is gradual (not steep).</li>
      <li>Multiplying with a sizable $$\alpha$$, will move W1 towards the green optima (bottom of the bowl)</li>
    </ul>
  </li>
  <li>Consider W2
    <ul>
      <li>Lets keep W1 constant resulting in the sliceW2.</li>
      <li>The curve that we have due to sliceW2 (left view) is at the beginning of the bowl and is steep.</li>
      <li>Multiplying with same sizable $$\alpha$$, will move W2 past the green optima (side of the bowl)</li>
    </ul>
  </li>
  <li>Essentially, W1 must increase considerably while W2 should reduce by small amount in each iteration.</li>
</ul>

<h1 id="momentum">Momentum</h1>

<p>Gradient with momentum takes a running average of the derivatives thus reducing the oscillations. For a given mini batch, running average for each layer is calculated as follows:
$$
\begin{gathered}
V_{dW} = \beta V_{dW} + (1 - \beta) dW <br>
V_{db} = \beta V_{db} + (1 - \beta) db
\end{gathered}
$$</p>

<p>Thus, calculated running averages  are used to update the weights.</p>

<p>$$
\begin{gathered}
W = W - \alpha v_{dW} <br>
b = b - \alpha v_{db}
\end{gathered}
$$</p>

<h1 id="momentum-with-rmsprop">Momentum with RMSprop</h1>

<h2 id="algorithm">Algorithm</h2>

<p>$$
\begin{gathered}
S_{dW} = \beta S_{dW} + (1 - \beta) dW^{2} <br>
S_{db} = \beta S_{db} + (1 - \beta) db^{2} <br>
<br>
W = W - \alpha \frac{dW}{\sqrt{S_{dW}+\epsilon}} <br>
b = b - \alpha \frac{db}{\sqrt{S_{db}+\epsilon}}
\end{gathered}
$$</p>

<p>RMS prop calculates</p>

<ul>
  <li>The running average of the square of the derivatives</li>
  <li>Updates the weights by dividing derivative by square root of running average</li>
  <li>$$\epsilon$$ is a very small value like $$10^{-8}$$ to prevent divide by zero.</li>
</ul>

<h2 id="working">Working</h2>

<p>When curve is steep, the derivative is large $$dW \\ and/or \\ db$$, so is $$S_{dW} \\ and/or \\ $_{db}$$.</p>

<ul>
  <li>The division of two relatively large numbers results in a moderate number.</li>
  <li>This ensures minimal oscillation despite $$\alpha$$ taking higher values.</li>
</ul>

<p>When curve is gradual, the derivative is small  $$dW \\ and/or \\ db$$, so is  $$S_{dW} \\ and/or \\ $_{db}$$.</p>

<ul>
  <li>The division of two relatively small numbers results in a moderate number</li>
  <li>This ensures that better acceleration with $$\alpha$$ taking higher values.</li>
</ul>

<p>Essentially, increasing $$\alpha$$ to increase acceleration among small derivatives won’t worsen the larger ones.</p>

<h1 id="momentum-with-adam">Momentum with Adam</h1>

<p>Adam is one of the algorithm that optimizes really well in many cases in NN. Combines momentum and RMSProp.</p>

<h2 id="algorithm-1">Algorithm</h2>

<p>$$
\begin{gathered}
V_{dW} = \beta_{1} V_{dW} + (1 - \beta_{1}) dW <br>
V_{db} = \beta_{1} V_{db} + (1 - \beta_{1}) db <br>
<br>
S_{dW} = \beta_{2} S_{dW} + (1 - \beta_{2}) dW^{2} <br>
S_{db} = \beta_{2} S_{db} + (1 - \beta_{2}) db^{2} <br>
<br>
W = W - \alpha \frac{V_{dW}}{\sqrt{S_{dW}+\epsilon}} <br>
b = b - \alpha \frac{V_{db}}{\sqrt{S_{db}+\epsilon}}
\end{gathered}
$$</p>

<p>Note</p>

<ul>
  <li>$$V_{dW}$$ calculates the running average of the derivative (Like Momentum)</li>
  <li>$$S_{dW}$$ calculates the running average of the square of the derivative (Like RMSProp)</li>
  <li>The weights are updated using a ratio of $$V_{dW}$$ and $$S_{dW}$$</li>
  <li>$$\epsilon$$ is a very small value like $$10^{-8}$$ to prevent divide by zero.</li>
</ul>

<h1 id="bias-correction">Bias Correction</h1>

<p>Bias correction is not necessary for algorithms that run for many iterations of  <code class="language-plaintext highlighter-rouge">t</code>. Note that t begins with a value of 1 and keeps incrementing for each mini batch across epochs.</p>

<p>That is, if there are 2 epochs with 25 mini batches each making a total of 50 mini batches then <code class="language-plaintext highlighter-rouge">t</code> takes values from 1 to 50.</p>

<p>However, bias correction can be implemented as follows</p>

<p>$$
\begin{gathered}
V_{dW} := \frac{V_{dW}}{(1 - \beta_{1}^{t})} <br>
V_{db} := \frac{V_{db}}{(1 - \beta_{1}^{t})} <br>
<br>
S_{dW} := \frac{S_{dW}}{(1 - \beta_{2}^{t})} <br>
S_{db} := \frac{S_{db}}{(1 - \beta_{2}^{t})} <br>
\end{gathered}
$$</p>

        </div>

        <div class="card-footer">
            
        </div>

    </div>

</div>
</div>
                <!-- <div id="footer" class="w-100"><div class="footer">
    <div class="footer-col footer-col-1">
    <ul class="contact-list">
      <li>
        <span class="site-author">
           
             Raghunandan.Seshadri
           
        </span>
      </li>

      
      <li><a href="mailto:raghubs81@gmail.com">raghubs81@gmail.com</a></li>
      

      
      <li>
        <a href="https://github.com/cafeduke"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">cafeduke</span></a>

      </li>
      

    </ul>
    </div>

    <div class="footer-col footer-col-2">
     <ul class="contact-list">
        
           <li>Duke notes. Happy learning!</li>
        
     </ul>
    </div>
</div></div> -->
            </div>
        </div>
    </div>

    <!-- JS -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

<!-- Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<!-- Bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<!-- Material JavaScript on top of Bootstrap JavaScript -->
<script src="/assets/daemonite-material/js/material.min.js"></script>

<!-- Include and configure MathJax -->
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
      jax: ["input/AsciiMath", "input/TeX", "input/MathML", "output/HTML-CSS"],
      asciimath2jax: {
         delimiters: [['`','`'], ['$$','$$'], ['$','$']]
      },
      "HTML-CSS": {
         preferredFont:"TeX", availableFonts:["STIX","TeX"]
      }
   });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>

<script src="/assets/js/mermaid.min.js"></script>

<!-- Google analytics -->


<!-- Sidebar -->
<script src="/assets/js/sidebar.js"></script>



   </body>

</html>
