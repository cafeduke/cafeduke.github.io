<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta data -->
    <meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, shrink-to-fit=no, width=device-width">
<meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Window title -->
    <title>Face Recognition</title>

    <!-- CSS -->
    <!-- Material fonts from 'https://fonts.google.com' -->
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Vollkorn:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"> 

<!-- Material Icon -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Font Awesome Icon -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

<!-- Add Material CSS. Replace Bootstrap CSS -->
<link href="/assets/daemonite-material/css/material.min.css" rel="stylesheet">

<!-- Material Color Palette - CSS Classes -->
<link href="/assets/material-design-color-palette/css/material-design-color-palette.css" rel="stylesheet">

<!-- CafeDuke CSS - Project specific Classes  -->
<link href="/assets/css/main.css" rel="stylesheet" type="text/css">

<!-- CafeDuke Syntax CSS - Code syntax highlight -->
<link href="/assets/css/duke-dark.css" rel="stylesheet" type="text/css">


<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

    <!-- Navigation bar -->
    <nav class="navbar navbar-expand-lg navbar-dark mdc-bg-purple-900">
    
    

    <!-- Collapse Icon -->
    <a id="sidebar-toggle" class="navbar-brand text-white" href="">
        <i class="material-icons md-24">menu</i>
    </a>

    <!-- NavBar Heading -->
    <a class="navbar-brand text-white" href="/">Cafe Duke Notes</a>

    <!-- Collapse button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">

        <!-- Links -->
        <ul class="navbar-nav mr-auto">


        </ul>
        <!-- Links -->

        <!-- Search form
        <form class="form-inline">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
        </form>
         -->

    </div>
    <!-- Collapsible content -->

</nav>


    <!-- Row: Content -->
    <div class="container-fluid m-0 p-0 h-100">

        <div class="row h-100 no-gutters">

            <!-- Column: Sidebar -->
            <div id="sidebar">

    <ul class="nav flex-column">

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/">
                <i class="fas fa-home fa-lg"></i>
                <span class="nav-link-text">Home</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/java">
                <i class="fab fa-java fa-2x"></i>
                <span class="nav-link-text">Java</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/git">
                <i class="fab fa-git fa-lg"></i>
                <span class="nav-link-text">Git</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/cloud">
                <i class="material-icons md-24">cloud</i>
                <span class="nav-link-text">Cloud</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" data-toggle="collapse" data-target="#child-dl" href="#">
                <i class="fas fa-cogs fa-lg"></i>
                <span class="nav-link-text">Deep Learning</span>
            </a>
            <div id="child-dl" class="collapse">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning">
                            <span class="nav-link-text">Core</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/strategy">
                            <span class="nav-link-text">Strategy</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/cnn">
                            <span class="nav-link-text">CNN</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="/deeplearning/rnn">
                            <span class="nav-link-text">RNN</span>
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/django">
                <i class="fa fa-lg">dj</i>
                <span class="nav-link-text">Django</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="/spring">
                <i class="fas fa-leaf fa-lg"></i>
                <span class="nav-link-text">Spring</span>
            </a>
        </li>

    </ul>
</div>


            <!-- Column: Content Wrapper -->
            <div class="col">
                <div id="content" class="w-100">
<div id="post-wrap" class="row d-flex justify-content-center">

    <div class="card col-md-10 col-xs-12 mt-5">

        <div class="card-header">
            <h1 class="post-title">Face Recognition</h1>
            <h6 class="card-subtitle post-meta"> 
                Monday, 24 September 2018
                
            </h6>            
        </div>

        <hr class="post-ruler">

        <div class="card-body">
            <nav>
  <h4>Table of Contents</h4>
<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#siamese-network" id="markdown-toc-siamese-network">Siamese Network</a></li>
  <li>
<a href="#triplet-loss-function" id="markdown-toc-triplet-loss-function">Triplet Loss Function</a>    <ol>
      <li><a href="#understanding-triplet-loss-function" id="markdown-toc-understanding-triplet-loss-function">Understanding triplet loss function</a></li>
      <li><a href="#choosing-images-for-a-p-and-n" id="markdown-toc-choosing-images-for-a-p-and-n">Choosing images for A, P and N</a></li>
    </ol>
  </li>
  <li><a href="#cnn-with-binary-classification" id="markdown-toc-cnn-with-binary-classification">CNN with binary classification</a></li>
  <li><a href="#face-recognition-during-test-time" id="markdown-toc-face-recognition-during-test-time">Face recognition during test time</a></li>
</ol>

</nav>

<h1 id="introduction">Introduction</h1>

<p>An application of face recognition is authenticating a person using his face rather than ID card. Another application is recommending to tag friends in an image posted on social media (like facebook) $$-$$ This requires comparing two images and outputting if it belongs to the same person or not.</p>

<p>Consider the problem of identifying the person from an image.</p>

<ul>
  <li>Lets say we are 5 friends.</li>
  <li>We could train a network model which outputs a softmax function (with 5 neurons) identifying the person. We could use thousands of images of each friend to train this network.</li>
  <li>What happens when a another friend joins the group? We may have to first get 1000s of images of the new member and retrain the entire model for 6 friends.</li>
</ul>

<p>The above method is very tedious requiring frequent retraining and also impractical to get 1000s of images every-time there is a new member.  What we need is a <strong>one-shot learning</strong>.  By just having one image of each friend in the database, we should be able to identify if a given image is one of our friend or not.</p>

<p>The solution is to train a model to output a <strong>similarity function</strong> $$-$$ How similar are two images.</p>

<ul>
  <li>A function d(img1, img2) will output a number that indicates the degree of difference between the images.</li>
  <li>A value less than a threshold indicates the images are similar.</li>
  <li>A value greater than threshold indicates the images are different.</li>
</ul>

<h1 id="siamese-network">Siamese Network</h1>

<p>A Siamese network has a single convolution that can be trained to input two images and output the distance between them.  The distance is used to determine if the images belong to the same person or not.</p>

<p>Consider a CNN that outputs a vector of values (128) per input image.</p>

<ul>
  <li>Use the same network to get the output vectors for two images (say x1, x2).</li>
  <li>The output generated by the CNN are basically the <strong>face feature encodings</strong> for each image.</li>
  <li>Compute the distance between the two vectors.</li>
  <li>The network is trained to minimize the distance between the vectors, if x1 == x2 (Same person)</li>
  <li>The network is trained to maximize the distance between the vectors, if x1 != x2 (Different people)</li>
</ul>

<p><img src="/assets/images/dl/FaceSiamese.png" alt="FaceSiamese"></p>

<p>$$
\begin{aligned}
f(x1) &amp;= Output \ vector \ with \ encoding \ of \ image \ x1 <br>
f(x2) &amp;= Output \ vector \ with \ encoding \ of \ image \ x2 <br>
Distance \ between \ vectors \ &amp;= \ \ d(x1, x2) \ = \ ( f(x1) - f(x2) )^2
\end{aligned}
$$</p>

<blockquote>
  <p>Distance between two vectors could be the square root of the sum of squares of elements (SOP) of the vector.</p>
</blockquote>

<h1 id="triplet-loss-function">Triplet Loss Function</h1>

<p>The Siamese network defined in the previous section will work well if the the network is well trained to output good  <strong>face feature encodings</strong>. One way to well train such a network is by using <strong>triplet loss function</strong>.</p>

<ul>
  <li>The triplet loss function uses three pairs of images Anchor (A), Positive (P) and Negative
    <ul>
      <li>Anchor is the image under question</li>
      <li>Positive is image of the same person as Anchor</li>
      <li>Negative is image of a different person</li>
    </ul>
  </li>
  <li>Calculate distance between anchor and positive image vectors. $$ d(A,P) = ( f(A) - f(P) )^2 $$
    <ul>
      <li>$$d(A,P)$$ should ideally be a value close to 0</li>
    </ul>
  </li>
  <li>Calculate distance between anchor and negative image vectors. $$ d(A,N) = ( f(A) - f(N) )^2 $$
    <ul>
      <li>$$d(A,N)$$ should ideally be a value close to 1</li>
    </ul>
  </li>
  <li>Let $$\alpha​$$ be the margin (distance separating two entities) between $$ d(A,P) ​$$ and $$ d(A,N) ​$$. Greater the  $$\alpha​$$ , greater distance is enforced between same and different images.</li>
</ul>

<p>Now, a loss function (cost or error function) is a function that needs to be minimized ( $$ideally, 0$$) in order to improve the working of the algorithm.</p>

<p>$$
\begin{aligned}
\Delta &amp;= d(A,P) - d(A,N) <br>
Triplet \ Loss \ Function &amp;= J(A,P,N) = max(0,\ d(A,P) - d(A,N) + \alpha)
\end{aligned}
$$</p>

<h2 id="understanding-triplet-loss-function">Understanding triplet loss function</h2>

<ul>
  <li>$$ \Delta$$ is a  negative number (ideally, $$ 0 - 1 = -1 $$)</li>
  <li>We would want  $$\Delta$$ to be negative enough to reduce  $$\alpha$$ below zero. Essentially, we would like $$ \alpha + \Delta &lt;= 0 $$</li>
  <li>If $$\alpha = 0.9$$  and $$\Delta$$ is $$-0.8$$, the triplet loss function will evaluate $$max(0, -0.8+0.9) = max (0, 0.1) = 0.1$$</li>
  <li>If the positive and negative distances are not far enough from each other, then the triplet loss function will be greater than zero.</li>
</ul>

<blockquote>
  <p>Triplet loss function penalizes if  $$d(A,P)$$ and $$d(A,N)$$ are closer than $$\alpha$$. 
Training using triplet loss function will require choosing images from training dataset for A, P and N to minimize $$J(A,P,N)$$</p>
</blockquote>

<h2 id="choosing-images-for-a-p-and-n">Choosing images for A, P and N</h2>

<p>Let say we randomly choose triplets combinations for A, P and N. That is, we pick pick two random images of the same person for A and P and image of a flower for N. This is easy for the network to differentiate between a person and a flower. Hence, it is not trained to work well with tough data and may fail on test/real-world use cases.</p>

<p>In order to make the algorithm robust, we need to images of the same person with different styles (hair color, hair style, facial expression etc) for A and P.  The image of the person we choose for N should be pretty similar (similar nose, eyes, skin color etc) to the person chosen for A.</p>

<blockquote>
  <p>Commercial face recognition companies train on millions of images (Ranging from 10 million to even 100 million). These companies have <strong>trained</strong> networks and <strong>posted weights online</strong>. This can be used as base.</p>
</blockquote>

<h1 id="cnn-with-binary-classification">CNN with binary classification</h1>

<p>A model that uses CNN with binary classification can used as an alternative to triplet loss for image recognition.</p>

<p><img src="/assets/images/dl/Face_BinaryClass.png" alt="Face_BinaryClass"></p>

<p>The CNN network takes two images as input and outputs a binary (1/0) output to indicate same or different images</p>

<ul>
  <li>The overall network has two convolutions $$-$$ one per image.</li>
  <li>Let $$f(x_i)$$ and $$f(x_j)$$ be the corresponding output encoding vectors.</li>
  <li>$$ f(x_i)$$ and $$f(x_j) $$ are concatenated to form $$x$$ which acts as input to a logistic regression. (Just like a logistic regression problem taking a bunch of features $$x$$ and outputting (1/0) indicating if the tumor is cancerous or not.)</li>
</ul>

<h1 id="face-recognition-during-test-time">Face recognition during test time</h1>

<p>Once a CNN for face recognition is well trained (using image pairs that are quite challenging to solve, even for human) it can be used to compare any two faces (Faces that were never seen earlier by the network).</p>

<p>In a company setting</p>

<ul>
  <li>A single image of all employees is inputted and only the <em>output feature encodings</em> are saved in database.</li>
  <li>When an employee approaches for authentication, his image from the camera passes though the CNN to obtain feature encoding.</li>
  <li>We now have feature encoding of the input image to be compared with feature encodings of all employees. This is done in one of the following ways
    <ul>
      <li>Calculate distance between encodings.</li>
      <li>Feed each pair of encodings to a Logistic Regression that gives a binary output (same or not)</li>
    </ul>
  </li>
</ul>


        </div>

        <div class="card-footer">
            
        </div>

    </div>

</div>
</div>
                <!-- <div id="footer" class="w-100"><div class="footer">
    <div class="footer-col footer-col-1">
    <ul class="contact-list">
      <li>
        <span class="site-author">
           
             Raghunandan.Seshadri
           
        </span>
      </li>

      
      <li><a href="mailto:raghubs81@gmail.com">raghubs81@gmail.com</a></li>
      

      
      <li>
        <a href="https://github.com/cafeduke"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">cafeduke</span></a>

      </li>
      

    </ul>
    </div>

    <div class="footer-col footer-col-2">
     <ul class="contact-list">
        
           <li>Duke notes. Happy learning!</li>
        
     </ul>
    </div>
</div></div> -->
            </div>
        </div>
    </div>

    <!-- JS -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

<!-- Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<!-- Bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<!-- Material JavaScript on top of Bootstrap JavaScript -->
<script src="/assets/daemonite-material/js/material.min.js"></script>

<!-- Include and configure MathJax -->
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
      jax: ["input/AsciiMath", "input/TeX", "input/MathML", "output/HTML-CSS"],
      asciimath2jax: {
         delimiters: [['`','`'], ['$$','$$'], ['$','$']]
      },
      "HTML-CSS": {
         preferredFont:"TeX", availableFonts:["STIX","TeX"]
      }
   });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>

<script src="/assets/js/mermaid.min.js"></script>

<!-- Google analytics -->


<!-- Sidebar -->
<script src="/assets/js/sidebar.js"></script>



   </body>

</html>
